<h1>Back-end</h1><div>The back-end system is written in PHP.</div><div>It's a service based rest system which usually returns a JSON formatted data.</div><div><br></div><div>It has some built-in features which will be explained in this section.</div><h4>Caveats</h4><div>Following PHP's convention, the PHP scripts in /api, should not have a closing tag <i>?&gt; </i>to avoid starting output buffer unnecessarily.</div><div><a href="http://php.net/manual/en/language.basic-syntax.phptags.php" target="_blank">http://php.net/manual/en/language.basic-syntax.phptags.php</a><br></div><div><br></div><div>Also to avoid PHP miss-configuration, do not use php short tags &lt;?, instead always use <i>&lt;?php</i>.</div><h2>index.php</h2><div>The entry point of the /api is the index.php.</div><div>All requests made under /api goes through /api/index.php.</div><div>The .htaccess in /api/.htaccess rewrites all requests to index.php, so any other file under /api besides index.php is accessible through HTTP request.</div><div><br></div><div>The index.php loads all the dependencies needed for running the Back-end system. It also uses PHP namespaces, and has a autoloader.php which auto-loads the PHP Classes.</div><div><br></div><div>Also, the index.php can be included in any other script outside the /api folder in order to execute the API's services.</div><h4>execute()</h4><div>The requests made to /api/some_service/some_method, is automatically executed by the <i>execute()</i>&nbsp;method in index.php.</div><div>When the index.php file is included in a script outside /api, the <i>execute()</i> method must be called manually.</div><pre>&lt;?php
include_once('api/index.php');

$output = execute('some_service/some_method', array('data'=&gt;'something'));

var_dump($output); // Will have the return value of the service.</pre><h4>?__debug__</h4><div>When calling the /api services including ?__debug__ argument in the URL, it'll allow debugging in the PHP script.</div><div>It sets the constant <b>DEBUG </b>in PHP as TRUE, and also will output errors and warnings.</div><div><br></div><h3>config.php (WIP)</h3><div>The config.php file (work in progress) is the configuration file which should have project specific variables such as MySQL Database connection credentials.</div><div><br></div><div>Also, there's a helper class <i>\slikland\core\Setting</i>&nbsp;which provide with a easy way to store configuration variables in the Database.</div><div>So if the configuration variable isn't required before the API initialization, please use the Setting class to store the variables.</div><div><br></div><h3>slikland/core/paths.php</h3><div>In this script, it's defined the constants regarding URI and system paths that should be used in the system.</div><div>The defined constants are:</div><div><br></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div><div>Example URL: http://somedomain.com/rootFolder/api/whatever</div><div>Example system path: /public_html/somedomain/rootFolder/api/whatever</div><div><br></div><div><b>HOST</b>: The host name (somedomain.com)</div><div><b>API_PATH</b>: System path to API (/public_html/somedomain/rootFolder/api/)</div><div><b>ROOT_PATH</b>: System path to the project's root folder (/public_html/somedomain/rootFolder/)</div><div><b>DYNAMIC_PATH</b>: System path to the dynamic folder (/public_html/somedomain/rootFolder/dynamic)</div><div><b>RELATIVE_URL</b>: Relative path of the URL to the project (/rootFolder/)</div><div><b>ROOT_URL</b>: The URL of the root of this project (http://somedomain.com/rootFolder/)</div><div><b>REQUEST_URI</b>: The URL of the request (whatever/)</div><div><b>CURRENT_URL</b>: current URL (http://somedomain.com/rootFolder/api/whatever)</div><div><b>SECURE</b>: Boolean if the request is using https or not</div></div></div></blockquote><div><br></div><h3>slikland/core/global.php</h3><div>global.php contains methods and class method alias that are used generally in the API.</div><div><br></div><h2>Services</h2><div>The services are classes and methods accessible through /api. Those classes should be used only to format and output data.</div><div>Generally speaking, in a MVC model, the service plays the role of View, which outputs data to front-end or whatever requesting service.</div><div>The service classes needs to be inside /api/service directory.</div><div><br></div><div>There are some built-in services needed for the CMS which can be found in /api/slikland/service.</div><h3>Annotations</h3><div>In the back-end PHP annotations are heavily used to decorate the service methods.</div><div>The annotations must go right above the function declaration inside a multiline comment starting with double asterisk.</div><div><br></div><pre>/**
@method POST
*/

function test(){
}</pre><div>The annotations are a atmark @ followed by name of the annotation and the parameters in JSON format.</div><div>In the above example, it's telling the system that the service <i>test</i>&nbsp;only accepts data sent as POST http method.</div><div><br></div><div>There are more examples of&nbsp;<a class="" id="22c27">PHP Annotations</a>&nbsp;further in this documentation.</div><div><br></div><h2>Modules</h2>Modules are where all the data manipulation occurs. In a MVC model, the role of Modules are mostly Controllers and sometimes Models.<div>The Model of MVC in this system may vary according to the architecture, but basically the Modules would control where the data should be stored and also retrieved from, wether it's a database or a file system or any other means.</div><div><br></div><div>The Modules classes are stored in the /api/module/ directory. Like the Service, there are some built-in Module classes in /api/slikland/module directory as well, which has some core functionality for CMS.</div><div><br></div><div>Modules can be loaded by calling the <i>get_module()</i> method.<div><pre>$someModule = get_module('path/to/module/without/module_directory');</pre><pre>$user = get_module('cms/User');
$user-&gt;login('user','pass');</pre></div></div><div><div>Modules can also be a Singleton class, meaning, it can be a persistent instance.&nbsp;</div><div>For example the CMS User module, once authenticated by the system, the same instance can be used through the whole process as the CMS User shouldn't change in a single request.</div><pre>$user = get_module('cms/User');
$user-&gt;getCurrent();

$user = get_module('cms/User', TRUE); // This will return a new User instance
$user-&gt;getCurrent();</pre></div><h2>Security</h2><div>There are several security implementations that are added to the system. Mostly are used to fulfill native methods.</div><h4>password($password, $salt = NULL)</h4><div>This method encodes password. As in MySQL 5.7+ the PASSWORD() method is deprecated, this PHP method should be used to encode passwords.</div><div>It uses a combination of hashing algorithms to ensure the security an also to minimize hash collisions.</div><div><br></div><div>The password method also accepts a $salt value, to have a stronger encryption.</div><h3>Unique IDs</h3><div>When using integer indexes, please use the <b>encode_uid($id), decode_uid($uid)</b>&nbsp;methods when presenting the <b>$id</b>&nbsp;publicly.</div><div>The <b>$id</b>&nbsp;is encoded to a string with a random key, which generates a invertible <b>$uid</b>, so the <b>$uid</b> can be reverted to the integer <b>$id</b>.</div><div>Also, as it's random, every time the <b>$id</b>&nbsp;is encoded, it uses random keys, so generates a different <b>$uid.</b></div><div><b><br></b></div><div>With the encoded <b>$id</b>, it protects the user from guessing sequential ids.</div><div>Also with the randomness, the same <b>$id</b>&nbsp;may have different <b>$uid</b>&nbsp;associated, so the same integer <b>$id&nbsp;</b>encoded for a user and another for a product record would have different <b>$uids</b>.</div><div><br></div><div>Examples: When saving user images, instead of using user's database row id, encode it and save the <b>$uid</b>&nbsp;in the Database for later retrieval.</div><div>When showing a public user profile page an it has a unique URL, such as http://somepage.com/user/ID, instead of a numeric ID, use the encoded <b>$uid</b>. The generated <b>$uid</b> should be stored in the database for persistence, so when using a different <b>$uid</b>&nbsp;with the same decoded <b>$id</b>&nbsp;it won't be accessible.</div><div><br></div><div><br></div><div><br></div>