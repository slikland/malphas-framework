<h1>DBHelper</h1><div>The DBHelper class (<b>/api/slikland/db/DBHelper.php</b>) is a helper to execute MySQL Queries.</div><div><br></div><div>It works in conjunction with <b>/api/slikland/db/SchemaParser.php</b></div><div>It needs a set of PHP scripts with MySQL Schema data.</div><div><br></div><div>Firstly, once you have your MySQL Tables set, call the API Service <b>/api/setup/exportDB</b>.</div><div>It'll generate some PHP scripts inside <b>/api/schema/</b> directory. Note you need to set write permission for PHP execution on this directory.</div><div><br></div><div>The class reference of DBHelper can be found at the bottom of this page.</div><div>Please read carefully this documentation before reaching the end of it.</div><h2><b>Database designing</b></h2><div>Please use MySQL Workbench for designing database schemas.</div><div>It creates visual structure when designing databases which gives you clear picture of the database you are building.</div><div><br></div><div>When designing the MySQL Tables, please use conventions below to make easily understandable and also avoid problems that may occur.</div><h4>KEYs</h4><h2><div style="font-size: 14px; font-weight: normal;">For table primary keys, always use pk_<b>tablename</b>&nbsp;and for foreign keys fk_<b>tablename</b>.</div><div style="font-size: 14px; font-weight: normal;">The primary key being integer with&nbsp;<b>AUTO_INCREMENT</b>.</div></h2><h4>Dates and times</h4><h2><div style="font-size: 14px; font-weight: normal;">For dates and times, please use always&nbsp;<b>DATETIME</b>&nbsp;type.</div><div style="font-size: 14px; font-weight: normal;">This way we can avoid having problem with&nbsp;<b>TIMESTAMP</b>&nbsp;formats as&nbsp;<b>TIMESTAMP</b>&nbsp;only works for dates after year 1970.</div><div style="font-size: 14px; font-weight: normal;">Also, beware when using&nbsp;<b>DEFAULT&nbsp;CURRENT_TIMESTAMP</b>. For MySQL 5.6 and earlier tables only can have one&nbsp;<b>DEFAULT CURRENT_TIMESTAMP</b>, so don't use more than one of those.</div><div style="font-size: 14px; font-weight: normal;"><br></div><div style="font-size: 14px; font-weight: normal;">Remember that working with time has differences in timezones depending on the server. Best would be treating the time difference manually instead of relying on server setting.</div></h2><h4>status</h4><h2><div style="font-size: 14px; font-weight: normal;">When using a status column, please set as INTEGER.</div><div style="font-size: 14px; font-weight: normal;">As convention, we use the status column to set record's state.</div><div style="font-size: 14px; font-weight: normal;">When deleting a record, instead of actually deleting, please use the&nbsp;<b>status</b>&nbsp;column. So we can keep records that was deleted as well for security reason.</div><div style="font-size: 14px; font-weight: normal;"><br></div><div style="font-size: 14px; font-weight: normal;">As convention, please set the "deleted" status to it's negative. So we'll be able to know in which state the record was deleted.</div><div style="font-size: 14px; font-weight: normal;">Example:</div><div style="font-size: 14px; font-weight: normal;">- A record that was with state 3, deleting will become state -3.</div><div style="font-size: 14px; font-weight: normal;"><br></div><div style="font-size: 14px; font-weight: normal;">In the future, the DBHelper class would treat the deleted records this way.</div></h2><h2>MySQL Schema data</h2><div>Those PHP Scripts are MySQL Schema information as PHP Object.</div><div>You <b>SHOULD NOT</b>&nbsp;touch inside <b>__schema</b>&nbsp;property.</div><div>This will be used to generate MySQL CREATE or ALTER TABLE queries.</div><h3>FIELDS</h3><div>In this property are set some the fields that can be used in this Schema.</div><div>The properties that are set as <b>FALSE</b>&nbsp;cannot be used when selecting.</div><div>As you can see, all <b>pks</b>&nbsp;and <b>fks</b>&nbsp;are set to <b>FALSE</b>.</div><div>All <b>pks</b>&nbsp;has a alias as <b>id</b>.</div><div>In future DBHelper may automatically set this <b>id</b>&nbsp;as <b>UIDEncoder::encode</b> value to avoid sending sequential numeric id to user.</div><div><br></div><div>Also, here you can set a field as reference to a field in another table. The referenced table needs to be referenced in the Schema with <b>fk</b>.</div><pre>    'id' =&gt; 'pk_cms_user',
    'pk_cms_user' =&gt; false,
    'cms_role_id' =&gt; 'cms_role.pk_cms_role',
    'email' =&gt; true,
    'pass' =&gt; false,
    'name' =&gt; true,
    'created' =&gt; true,
    'status' =&gt; true,
    'password_changed' =&gt; false,
    'checksum' =&gt; true,<br></pre><h3><b>REFS</b></h3><div>The <b>REFS</b> property holds the tables that are referenced by the current.</div><div>It helps building the LEFT JOIN syntax. So if you need to set a specific condition when JOINing, you can set is here.</div><h3><b>VIEWS</b></h3><div>Here you can set a preset of a SELECT query.</div><div>Those views can be accessed by DBHelper as in below example:</div><pre>$user = new \slikland\db\DBHelper('user.someview');
$user-&gt;get();

//OR

$user = new \slikland\db\DBHelper('user');
$user-&gt;get('someview');</pre><h2>Modifier syntax</h2><div>To make the Schema configuration more dynamic, here are some modifiers that can be used in some cases.</div><div><br></div><div>The queries are built by DBHelper and with PHP's mysqli statement (<a href="http://php.net/manual/en/mysqli.prepare.php" target="_blank">http://php.net/manual/en/mysqli.prepare.php</a>)<br><br></div><div>This way, when possible it tries to bind parameters to avoid data mismatch or query injections.</div><div>So it's important to use the right syntax for the Schema.</div><h3><b>* (right side) (NOT IMPLEMENTED YET)</b></h3><div>Using * (asterisk) on the right side of fields will create a subset with Array of the referenced table.</div><h3>!, &gt;, &lt;, &gt;=, &lt;= (WHERE)</h3><div>Using those signs after the field name on <b>where</b> property works as a condition for WHERE clauses.</div><div><br></div><pre>"name!" =&gt; "some name" // Different
"age&gt;" =&gt; 10 // Age greater than 10
"year&lt;=" =&gt; 2000 // year lower or equal than 2000</pre><h3><b>%, !% (WHERE)</b></h3><div>Using % at the end of field name, it'll use <b>LIKE</b>&nbsp;instead of <b>=</b>.</div><pre>"name%"=&gt;"some name" // WHERE `name` LIKE "some name"
"name!%"=&gt;"some name" // WHERE `name` NOT LIKE "some name"</pre><h3><b>? (WHERE)</b></h3><div><div>Using ? at the end of field name, it'll treat the value as a MySQL expression.</div></div><pre>"date" =&gt; "NOW()" // WHERE `date` = NOW()</pre><h3><b>array on WHERE</b></h3><div>Using array on right side of WHERE properties will used as <b>IN</b>&nbsp;clause. Note, an array, not object.<br><pre>"name" =&gt; array("some", "name") // WHERE `name` in ("some", "name")</pre></div><h3>&amp;, | operators (WHERE)</h3><div>Using the <b>&amp;, |</b>&nbsp;changes how the WHERE conditions are treated. It can used at the beginning of a field, or independently with a associative array assigned.</div><pre>"name"=&gt;"some", "|name"=&gt;"name" // WHERE `name` = "some" OR `name` = "name"

"|"=&gt;array("name"=&gt;"some name") // WHERE ... OR (`name` = "some name")
</pre><div><hr id="null"></div><h2>DBHelper Class Reference</h2><h3>constructor($tableName)</h3><div><br></div><h3>get(<span style="font-weight: normal;">$viewName = NULL, $fields = NULL, $where = NULL, $order = NULL, $limit = NULL</span>)</h3><div><br></div><h3><b>foundRows()</b></h3><div>This will return the number of rows in the previous <b>get()</b>&nbsp;call with a limit set.</div><div>It uses&nbsp;<b>SQL_CALC_FOUND_ROWS</b>&nbsp;in the previous call and later&nbsp;<b>SELECT FOUND_ROWS();</b></div><h3>count(<span style="font-weight: normal;">$view = NULL</span>)</h3><div><br></div><h3>set()</h3><div><br></div><h3>delete()</h3><div><br></div><div><br></div>